<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ü–æ–ª–∏—Å—ã –î–ú–°</title>

    <style>
        :root{
          --bg: #F6F0E6;
          --card: #FFFFFF;
          --ink: #1F2A37;
          --muted: #6B7280;
          --line: rgba(31,42,55,.10);
          --blue: #11A6B7;
          --blue-2:#0B8EA0;
          --beige-2:#FFF8EE;
          --shadow-soft: 0 10px 24px rgba(31,42,55,.08);
          --shadow: 0 10px 30px rgba(17,166,183,.12);
          --r: 18px;
        }
        *{ box-sizing:border-box; }
        body{
          margin:0;
          font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
          color: var(--ink);
          background:
            radial-gradient(900px 420px at 80% -10%, rgba(17,166,183,.18), transparent 60%),
            radial-gradient(700px 360px at 10% 0%, rgba(17,166,183,.10), transparent 55%),
            var(--bg);
        }
        .wrap{ max-width: 1200px; margin: 0 auto; padding: 26px 16px 44px; }

        .topbar{
          background: rgba(255,255,255,.72);
          border: 1px solid var(--line);
          border-radius: var(--r);
          padding: 14px 16px;
          display:flex;
          align-items:center;
          gap: 12px;
          box-shadow: var(--shadow-soft);
          backdrop-filter: blur(8px);
          flex-wrap: wrap;
        }
        .brand{ display:flex; align-items:center; gap:10px; min-width: 240px; }
        .logo{
          width: 42px; height: 42px; border-radius: 14px;
          background: linear-gradient(135deg, var(--blue), rgba(17,166,183,.55));
          box-shadow: 0 10px 22px rgba(17,166,183,.22);
        }
        .brand h1{ margin:0; font-size: 18px; line-height: 1.15; }
        .brand p{ margin:2px 0 0; font-size: 12px; color: var(--muted); }

        .spacer{ flex: 1; }

        .chip{
          display:inline-flex; align-items:center; gap:8px;
          padding: 8px 10px;
          border-radius: 999px;
          background: var(--beige-2);
          border: 1px solid rgba(31,42,55,.10);
          font-size: 13px;
          white-space: nowrap;
        }
        .dot{ width:8px; height:8px; border-radius: 50%; background: var(--blue); box-shadow: 0 0 0 4px rgba(17,166,183,.12); }

        .btn, .link-btn{
          border-radius: 12px;
          padding: 10px 12px;
          font-weight: 900;
          border: 1px solid rgba(31,42,55,.14);
          background: #fff;
          color: var(--ink);
          cursor:pointer;
          text-decoration: none;
          display:inline-flex;
          align-items:center;
          gap:8px;
          white-space: nowrap;
        }
        .btn:hover, .link-btn:hover{ background: rgba(17,166,183,.06); border-color: rgba(17,166,183,.40); }
        .btn-primary, .link-primary{
          border-color: rgba(17,166,183,.35);
          color: var(--blue-2);
          background: #fff;
        }
        .btn-danger{
          border-color: rgba(239,68,68,.35);
          color: #b91c1c;
          background: #fff;
        }
        .btn-danger:hover{
          background: rgba(239,68,68,.06);
          border-color: rgba(239,68,68,.55);
        }

        .hero{
          margin-top: 14px;
          background: var(--card);
          border: 1px solid var(--line);
          border-radius: var(--r);
          padding: 18px;
          box-shadow: var(--shadow-soft);
          position: relative;
          overflow:hidden;
        }
        .hero:before{
          content:"";
          position:absolute; inset:-60px -90px auto auto;
          width: 240px; height: 240px; border-radius: 50%;
          background: radial-gradient(circle at 30% 30%, rgba(17,166,183,.28), transparent 60%);
          transform: rotate(12deg);
        }
        .hero h2{ margin:0; font-size: 20px; }
        .hero p{ margin:8px 0 0; color: var(--muted); max-width: 90ch; }

        .toolbar{
          margin-top: 12px;
          display:flex;
          gap: 10px;
          flex-wrap: wrap;
          align-items:center;
        }
        .search{
          flex: 1;
          min-width: 260px;
          display:flex;
          gap: 10px;
          flex-wrap: wrap;
          align-items:center;
          background: rgba(255,255,255,.72);
          border: 1px solid var(--line);
          border-radius: var(--r);
          padding: 12px;
          box-shadow: var(--shadow);
        }
        .field{
          display:flex;
          flex-direction: column;
          gap: 6px;
          flex: 1;
          min-width: 220px;
        }
        .field label{ font-size: 12px; color: var(--muted); }
        input[type="text"]{
          padding: 10px 12px;
          border-radius: 12px;
          border: 1px solid rgba(31,42,55,.18);
          background: #fff;
          outline:none;
          font-weight: 700;
        }
        input[type="text"]:focus{
          border-color: rgba(17,166,183,.55);
          box-shadow: 0 0 0 4px rgba(17,166,183,.12);
        }

        .table-card{
          margin-top: 12px;
          background: var(--card);
          border: 1px solid var(--line);
          border-radius: var(--r);
          box-shadow: var(--shadow-soft);
          overflow:hidden;
        }
        .table-head{
          padding: 12px 16px;
          border-bottom: 1px solid var(--line);
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap: 10px;
          background: rgba(255,255,255,.60);
        }
        .table-head .hint{ color: var(--muted); font-size: 13px; }

        .table-wrap{ overflow:auto; }
        table{
          width: 100%;
          border-collapse: collapse;
          min-width: 980px;
        }
        thead th{
          text-align:left;
          font-size: 12px;
          letter-spacing: .03em;
          text-transform: uppercase;
          color: #111827;
          background: rgba(255,248,238,.85);
          border-bottom: 1px solid var(--line);
          padding: 12px 12px;
          white-space: nowrap;
        }
        tbody td{
          padding: 12px 12px;
          border-bottom: 1px solid rgba(31,42,55,.08);
          vertical-align: top;
        }
        tbody tr:hover{ background: rgba(17,166,183,.05); }

        .muted{ color: var(--muted); font-size: 13px; }
        .mono{ font-variant-numeric: tabular-nums; font-feature-settings: "tnum" 1; }

        .status{
          display:inline-flex;
          align-items:center;
          gap: 8px;
          font-weight: 900;
          font-size: 12px;
          padding: 6px 10px;
          border-radius: 999px;
          border: 1px solid rgba(31,42,55,.10);
          background: var(--beige-2);
          white-space: nowrap;
        }
        .led{ width: 8px; height: 8px; border-radius: 50%; background: #9CA3AF; box-shadow: 0 0 0 4px rgba(156,163,175,.14); }
        .st-active .led{ background:#22c55e; box-shadow: 0 0 0 4px rgba(34,197,94,.12); }
        .st-expired .led{ background:#f59e0b; box-shadow: 0 0 0 4px rgba(245,158,11,.12); }
        .st-cancelled .led{ background:#ef4444; box-shadow: 0 0 0 4px rgba(239,68,68,.12); }

        .actions{
          display:flex;
          gap: 8px;
          flex-wrap: wrap;
          align-items:center;
        }
        .inline-form{ display:inline; margin:0; }

        .empty{
          padding: 16px;
          color: var(--muted);
        }

        .sort-link{
          display:inline-flex;
          align-items:center;
          gap:6px;
          text-decoration:none;
          color:#111827;
          font-weight:800;

        .sort-ico{
          width:22px; height:22px;
          border-radius:10px;
          display:grid; place-items:center;
          background:rgba(17,166,183,.10);
          border:1px solid rgba(17,166,183,.18);
          color:var(--blue-2);
          font-size:12px;
        }

        .sort-link:hover .sort-ico{
          border-color: rgba(17,166,183,.55);
          box-shadow: 0 0 0 3px rgba(17,166,183,.12);
        }
    body {
        background-attachment: fixed;
        background-repeat: no-repeat;
    }
    </style>
</head>

<body>
<div class="wrap">

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —É–¥–∞–ª–µ–Ω–∏—è -->
    <div th:if="${errorMessage}" style="margin-bottom: 12px;">
        <div style="padding: 10px 14px; border-radius: 14px; background: rgba(239,68,68,.1); color:#991b1b; border:1px solid rgba(239,68,68,.25);">
            <span th:text="${errorMessage}">–û—à–∏–±–∫–∞</span>
        </div>
    </div>

    <div class="topbar">
        <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
                <h1>–ü–æ–ª–∏—Å—ã –î–ú–°</h1>
                <p>–ü–æ–∏—Å–∫, –ø—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
            </div>
        </div>

        <div class="chip">
            <span class="dot" aria-hidden="true"></span>
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <b sec:authentication="name">username</b>
        </div>

        <div class="spacer"></div>

        <a class="link-btn link-primary" th:href="@{/}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>

        <span sec:authorize="hasAnyRole('MANAGER','ADMIN')">
          <a class="link-btn btn-primary" th:href="@{/policies/new}">Ôºã –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–ª–∏—Å</a>
        </span>
    </div>

    <div class="hero">
        <h2>–°–ø–∏—Å–æ–∫ –ø–æ–ª–∏—Å–æ–≤</h2>
        <p>
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–∏—Å–∫, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ –ø–æ–ª–∏—Å –ø–æ –Ω–æ–º–µ—Ä—É, –∫–ª–∏–µ–Ω—Ç—É –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–µ.
            –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω—É–∂–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞.
        </p>
    </div>

    <!-- –ü–æ–∏—Å–∫ -->
    <form class="toolbar" th:action="@{/policies}" method="get">
        <div class="search">
            <div class="field">
                <label for="keyword">–ü–æ–∏—Å–∫</label>
                <input id="keyword"
                       type="text"
                       name="keyword"
                       placeholder="–ù–æ–º–µ—Ä / –∫–ª–∏–µ–Ω—Ç / –ø—Ä–æ–≥—Ä–∞–º–º–∞"
                       th:value="${keyword}">
            </div>

            <div class="field">
                <label for="statusFilter">–°—Ç–∞—Ç—É—Å –ø–æ–ª–∏—Å–∞</label>
                <select id="statusFilter" name="statusFilter">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option th:each="st : ${allStatuses}"
                            th:value="${st}"
                            th:text="${st}"
                            th:selected="${statusFilter} == ${st}">
                    </option>
                </select>
            </div>

            <input type="hidden" name="sortField" th:value="${sortField}">
            <input type="hidden" name="sortDir" th:value="${sortDir}">

            <button class="btn btn-primary" type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <a class="link-btn" th:href="@{/policies}">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table-card">
        <div class="table-head">
            <div class="hint">
                –ù–∞–π–¥–µ–Ω–æ: <b th:text="${#lists.size(policies)}">0</b>
            </div>
            <div class="hint">–î–µ–π—Å—Ç–≤–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ä–æ–ª–µ–π MANAGER / ADMIN</div>
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='id',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            ID
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='policyNumber',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –ù–æ–º–µ—Ä –ø–æ–ª–∏—Å–∞
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='client.fullName',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –ö–ª–∏–µ–Ω—Ç
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='program.name',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –ü—Ä–æ–≥—Ä–∞–º–º–∞
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='startDate',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='endDate',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='premium',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –ü—Ä–µ–º–∏—è
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/policies(
                                sortField='status',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                statusFilter=${statusFilter}
                           )}">
                            –°—Ç–∞—Ç—É—Å
                            <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th sec:authorize="hasAnyRole('MANAGER','ADMIN')">–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${policies}">
                    <td class="mono" th:text="${p.id}"></td>
                    <td class="mono" th:text="${p.policyNumber}"></td>

                    <td th:text="${p.client != null ? p.client.fullName : '‚Äî'}"></td>
                    <td th:text="${p.program != null ? p.program.name : '‚Äî'}"></td>

                    <td class="mono" th:text="${p.startDate}"></td>
                    <td class="mono" th:text="${p.endDate}"></td>

                    <td class="mono" th:text="${p.premium}"></td>

                    <td>
                        <span class="status"
                              th:classappend="${p.status.name() == 'ACTIVE' ? ' st-active' : (p.status.name() == 'EXPIRED' ? ' st-expired' : ' st-cancelled')}">
                            <span class="led" aria-hidden="true"></span>
                            <span th:text="${p.status}">ACTIVE</span>
                        </span>
                    </td>


                    <td sec:authorize="hasAnyRole('MANAGER','ADMIN')">
                        <div class="actions">
                            <a class="link-btn btn-primary"
                               th:href="@{'/policies/' + ${p.id} + '/edit'}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

                            <form class="inline-form"
                                  th:action="@{'/policies/' + ${p.id} + '/delete'}"
                                  method="post"
                                  onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø–æ–ª–∏—Å?');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-danger" type="submit">üóë –£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        </div>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(policies)}">
                    <td class="empty" colspan="9">–ü–æ–ª–∏—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
</body>
</html>