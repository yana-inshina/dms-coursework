<!DOCTYPE html>
<html lang="ru"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–°—Ç—Ä–∞—Ö–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</title>

    <style>
        :root{
          --bg:#F6F0E6;
          --card:#FFFFFF;
          --ink:#1F2A37;
          --muted:#6B7280;
          --line:rgba(31,42,55,.10);
          --blue:#11A6B7;
          --blue-2:#0B8EA0;
          --beige-2:#FFF8EE;
          --shadow-soft:0 10px 24px rgba(31,42,55,.08);
          --shadow:0 10px 30px rgba(17,166,183,.12);
          --r:18px;
        }
        *{ box-sizing:border-box; }
        body{
          margin:0;
          font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
          color:var(--ink);
          background:
            radial-gradient(900px 420px at 80% -10%, rgba(17,166,183,.18), transparent 60%),
            radial-gradient(700px 360px at 10% 0%, rgba(17,166,183,.10), transparent 55%),
            var(--bg);
        }
        .wrap{ max-width:1200px; margin:0 auto; padding:26px 16px 44px; }

        .topbar{
          background:rgba(255,255,255,.72);
          border:1px solid var(--line);
          border-radius:var(--r);
          padding:14px 16px;
          display:flex;
          align-items:center;
          gap:12px;
          box-shadow:var(--shadow-soft);
          backdrop-filter:blur(8px);
          flex-wrap:wrap;
        }
        .brand{ display:flex; align-items:center; gap:10px; min-width:260px; }
        .logo{
          width:42px; height:42px; border-radius:14px;
          background:linear-gradient(135deg, var(--blue), rgba(17,166,183,.55));
          box-shadow:0 10px 22px rgba(17,166,183,.22);
        }
        .brand h1{ margin:0; font-size:18px; line-height:1.15; }
        .brand p{ margin:2px 0 0; font-size:12px; color:var(--muted); }
        .spacer{ flex:1; }

        .btn, .link-btn{
          border-radius:12px;
          padding:10px 12px;
          font-weight:900;
          border:1px solid rgba(31,42,55,.14);
          background:#fff;
          color:var(--ink);
          cursor:pointer;
          text-decoration:none;
          display:inline-flex;
          align-items:center;
          gap:8px;
          white-space:nowrap;
        }
        .btn:hover, .link-btn:hover{ background:rgba(17,166,183,.06); border-color:rgba(17,166,183,.40); }
        .btn-primary, .link-primary{
          border-color:rgba(17,166,183,.35);
          color:var(--blue-2);
        }
        .btn-danger{
          border-color:rgba(239,68,68,.35);
          color:#b91c1c;
          background:#fff;
        }
        .btn-danger:hover{ background:rgba(239,68,68,.06); border-color:rgba(239,68,68,.55); }

        .chip{
          display:inline-flex; align-items:center; gap:8px;
          padding:8px 10px;
          border-radius:999px;
          background:var(--beige-2);
          border:1px solid rgba(31,42,55,.10);
          font-size:13px;
          white-space:nowrap;
        }
        .dot{ width:8px; height:8px; border-radius:50%; background:var(--blue); box-shadow:0 0 0 4px rgba(17,166,183,.12); }

        .hero{
          margin-top:14px;
          background:var(--card);
          border:1px solid var(--line);
          border-radius:var(--r);
          padding:18px;
          box-shadow:var(--shadow-soft);
          position:relative;
          overflow:hidden;
        }
        .hero:before{
          content:"";
          position:absolute; inset:-60px -90px auto auto;
          width:240px; height:240px; border-radius:50%;
          background:radial-gradient(circle at 30% 30%, rgba(17,166,183,.28), transparent 60%);
          transform:rotate(12deg);
        }
        .hero h2{ margin:0; font-size:20px; }
        .hero p{ margin:8px 0 0; color:var(--muted); max-width:90ch; }

        .toolbar{
          margin-top:12px;
          display:flex;
          gap:10px;
          flex-wrap:wrap;
          align-items:center;
        }
        .search{
          flex:1;
          min-width:260px;
          display:flex;
          gap:10px;
          flex-wrap:wrap;
          align-items:center;
          background:rgba(255,255,255,.72);
          border:1px solid var(--line);
          border-radius:var(--r);
          padding:12px;
          box-shadow:var(--shadow);
        }
        .field{
          display:flex; flex-direction:column; gap:6px;
          flex:1; min-width:220px;
        }
        .field label{ font-size:12px; color:var(--muted); }
        input[type="text"]{
          padding:10px 12px;
          border-radius:12px;
          border:1px solid rgba(31,42,55,.18);
          background:#fff;
          outline:none;
          font-weight:700;
        }
        input[type="text"]:focus{
          border-color:rgba(17,166,183,.55);
          box-shadow:0 0 0 4px rgba(17,166,183,.12);
        }

        .table-card{
          margin-top:12px;
          background:var(--card);
          border:1px solid var(--line);
          border-radius:var(--r);
          box-shadow:var(--shadow-soft);
          overflow:hidden;
        }
        .table-head{
          padding:12px 16px;
          border-bottom:1px solid var(--line);
          display:flex;
          align-items:center;
          justify-content:space-between;
          gap:10px;
          background:rgba(255,255,255,.60);
          flex-wrap:wrap;
        }
        .hint{ color:var(--muted); font-size:13px; }

        .table-wrap{ overflow:auto; }
        table{
          width:100%;
          border-collapse:collapse;
          min-width: 900px;
        }
        thead th{
          text-align:left;
          font-size:12px;
          letter-spacing:.03em;
          text-transform:uppercase;
          color:#111827;
          background:rgba(255,248,238,.85);
          border-bottom:1px solid var(--line);
          padding:12px 12px;
          white-space:nowrap;
        }
        tbody td{
          padding:12px 12px;
          border-bottom:1px solid rgba(31,42,55,.08);
          vertical-align:top;
        }
        tbody tr:hover{ background:rgba(17,166,183,.05); }

        .sort-link{
          color:inherit;
          text-decoration:none;
          display:inline-flex;
          align-items:center;
          gap:8px;
          font-weight:900;
        }
        .sort-ico{
          width:22px; height:22px;
          border-radius:10px;
          display:grid; place-items:center;
          background:rgba(17,166,183,.10);
          border:1px solid rgba(17,166,183,.18);
          color:var(--blue-2);
          font-size:12px;
        }

        .badge{
          display:inline-flex; align-items:center; gap:8px;
          font-weight:900;
          font-size:12px;
          padding:6px 10px;
          border-radius:999px;
          border:1px solid rgba(31,42,55,.10);
          background:var(--beige-2);
          white-space:nowrap;
        }
        .led{ width:8px; height:8px; border-radius:50%; background:#9CA3AF; box-shadow:0 0 0 4px rgba(156,163,175,.14); }
        .on .led{ background:#22c55e; box-shadow:0 0 0 4px rgba(34,197,94,.12); }
        .off .led{ background:#ef4444; box-shadow:0 0 0 4px rgba(239,68,68,.12); }

        .actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
        .inline-form{ display:inline; margin:0; }
        .mono{ font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1; }

        .empty{ padding:16px; color:var(--muted); }

        .program-link{
          text-decoration:none;
          font-weight:600;
          color:var(--blue-2);
        }
        .program-link:hover{
          text-decoration:underline;
        }
    body {
        background-attachment: fixed;
        background-repeat: no-repeat;
    }
    </style>
</head>

<body>
<div class="wrap">

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —É–¥–∞–ª–µ–Ω–∏—è -->
    <div th:if="${errorMessage}" style="margin-bottom: 12px;">
        <div style="padding: 10px 14px; border-radius: 14px; background: rgba(239,68,68,.1); color:#991b1b; border:1px solid rgba(239,68,68,.25);">
            <span th:text="${errorMessage}">–û—à–∏–±–∫–∞</span>
        </div>
    </div>

    <div class="topbar">
        <div class="brand">
            <div class="logo" aria-hidden="true"></div>
            <div>
                <h1>–°—Ç—Ä–∞—Ö–æ–≤—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h1>
                <p>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø—Ä–æ–≥—Ä–∞–º–º –î–ú–°</p>
            </div>
        </div>

        <div class="chip">
            <span class="dot" aria-hidden="true"></span>
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <b sec:authentication="name">username</b>
        </div>

        <div class="spacer"></div>

        <a class="link-btn link-primary" th:href="@{/}">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>

        <span sec:authorize="hasAnyRole('MANAGER','ADMIN')">
          <a class="link-btn btn-primary" th:href="@{/programs/new}">Ôºã –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</a>
        </span>
    </div>

    <div class="hero">
        <h2>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º</h2>
        <p>
            –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é. –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ–ª–±—Ü–∞ (–ö–æ–¥/–ù–∞–∑–≤–∞–Ω–∏–µ/–¶–µ–Ω–∞/–ê–∫—Ç–∏–≤–Ω–∞).
            –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É—Å–ª–æ–≤–∏–π –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ <b>–Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</b> ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∞.
        </p>
    </div>

    <!-- –ü–æ–∏—Å–∫ + —Ñ–∏–ª—å—Ç—Ä –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <form class="toolbar" th:action="@{/programs}" method="get">
        <div class="search">
            <!-- –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é -->
            <div class="field">
                <label for="keyword">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</label>
                <input id="keyword"
                       type="text"
                       name="keyword"
                       th:value="${keyword != null and !keyword.isBlank() ? keyword : null}"
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–µ–º–∏—É–º">
            </div>

            <!-- —Ñ–∏–ª—å—Ç—Ä –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
            <div class="field">
                <label for="activeFilter">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
                <select id="activeFilter" name="activeFilter">
                    <option value="all"
                            th:selected="${activeFilter == null or activeFilter == 'all'}">
                        –í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
                    </option>
                    <option value="active"
                            th:selected="${activeFilter == 'active'}">
                        –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
                    </option>
                    <option value="inactive"
                            th:selected="${activeFilter == 'inactive'}">
                        –¢–æ–ª—å–∫–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ
                    </option>
                </select>
            </div>

            <!-- —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ä–µ–≥–∏–æ–Ω—É –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (FR‚Äë02) -->
            <div class="field">
                <label for="regionFilter">–†–µ–≥–∏–æ–Ω</label>
                <select id="regionFilter" name="regionId">
                    <option value="" th:selected="${regionId == null}">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                    <option th:each="reg : ${allRegions}"
                            th:value="${reg.id}"
                            th:text="${reg.name}"
                            th:selected="${regionId != null and reg.id == regionId}"></option>
                </select>
            </div>

            <!-- —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é (FR‚Äë02) -->
            <div class="field">
                <label for="coverageFilter">–ü–æ–∫—Ä—ã—Ç–∏–µ</label>
                <select id="coverageFilter" name="coverageId">
                    <option value="" th:selected="${coverageId == null}">–í—Å–µ –ø–æ–∫—Ä—ã—Ç–∏—è</option>
                    <option th:each="cov : ${allCoverages}"
                            th:value="${cov.id}"
                            th:text="${cov.name}"
                            th:selected="${coverageId != null and cov.id == coverageId}"></option>
                </select>
            </div>

            <!-- —Ñ–∏–ª—å—Ç—Ä –ø–æ –∞–∫—Ü–∏–∏ (–Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ü–∏–π) (FR‚Äë02) -->
            <div class="field">
                <label for="promoFilter">–ê–∫—Ü–∏–∏</label>
                <select id="promoFilter" name="promo">
                    <option value="all" th:selected="${promo == null || promo == 'all'}">–í—Å–µ</option>
                    <option value="yes" th:selected="${promo == 'yes'}">–¢–æ–ª—å–∫–æ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∞–∫—Ü–∏—è–º–∏</option>
                    <option value="no" th:selected="${promo == 'no'}">–ë–µ–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–∫—Ü–∏–π</option>
                </select>
            </div>

            <!-- —Å–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
            <input type="hidden" name="sortField" th:value="${sortField}">
            <input type="hidden" name="sortDir" th:value="${sortDir}">

            <button class="btn btn-primary" type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            <a class="link-btn" th:href="@{/programs}">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <div class="table-card">
        <div class="table-head">
            <div class="hint">
                –ù–∞–π–¥–µ–Ω–æ:
                <b th:text="${#lists.size(programs)}">0</b>
            </div>
            <div class="hint">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è MANAGER / ADMIN</div>
        </div>

        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>ID</th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/programs(
                                sortField='code',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                activeFilter=${activeFilter},
                                regionId=${regionId},
                                coverageId=${coverageId},
                                promo=${promo}
                           )}">
                            –ö–æ–¥ <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/programs(
                                sortField='name',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                activeFilter=${activeFilter},
                                regionId=${regionId},
                                coverageId=${coverageId},
                                promo=${promo}
                           )}">
                            –ù–∞–∑–≤–∞–Ω–∏–µ <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/programs(
                                sortField='basePrice',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                activeFilter=${activeFilter},
                                regionId=${regionId},
                                coverageId=${coverageId},
                                promo=${promo}
                           )}">
                            –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>
                        <a class="sort-link"
                           th:href="@{/programs(
                                sortField='active',
                                sortDir=${reverseSortDir},
                                keyword=${keyword},
                                activeFilter=${activeFilter},
                                regionId=${regionId},
                                coverageId=${coverageId},
                                promo=${promo}
                           )}">
                            –ê–∫—Ç–∏–≤–Ω–∞ <span class="sort-ico">‚Üï</span>
                        </a>
                    </th>

                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="p : ${programs}">
                    <!-- ID -->
                    <td class="mono" th:text="${p.id}">1</td>

                    <!-- –ö–û–î -->
                    <td class="mono" th:text="${p.code}">BASIC_2024</td>

                    <!-- –ù–ê–ó–í–ê–ù–ò–ï -> —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
                    <td>
                        <a class="program-link"
                           th:href="@{/programs/{id}(id=${p.id})}"
                           th:text="${p.name}">
                            –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –î–ú–°
                        </a>
                    </td>

                    <!-- –ë–ê–ó–û–í–ê–Ø –¶–ï–ù–ê -->
                    <td class="mono" th:text="${p.basePrice}">15000.00</td>

                    <!-- –ê–ö–¢–ò–í–ù–ê -->
                    <td>
                        <span class="badge" th:classappend="${p.active} ? ' on' : ' off'">
                            <span class="led" aria-hidden="true"></span>
                            <span th:text="${p.active} ? '–î–∞' : '–ù–µ—Ç'">–î–∞</span>
                        </span>
                    </td>

                    <!-- –î–ï–ô–°–¢–í–ò–Ø -->
                    <td>
                        <div class="actions">
                            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É (–¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π) -->
                            <a class="btn btn-primary"
                               th:href="@{/applications/new(programId=${p.id})}">
                                –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                            </a>

                            <!-- –ê–¥–º–∏–Ω—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å / —É–¥–∞–ª–∏—Ç—å -->
                            <span sec:authorize="hasAnyRole('MANAGER','ADMIN')">
                              <a class="link-btn btn-primary"
                                 th:href="@{/programs/{id}/edit(id=${p.id})}">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>

                              <form class="inline-form"
                                    th:action="@{/programs/{id}/delete(id=${p.id})}"
                                    method="post"
                                    onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É?');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button class="btn btn-danger" type="submit">üóë –£–¥–∞–ª–∏—Ç—å</button>
                              </form>
                            </span>
                        </div>
                    </td>

                </tr>

                <tr th:if="${#lists.isEmpty(programs)}">
                    <td class="empty" colspan="6">–ü—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (FR‚Äë02) -->
    <div class="pagination" th:if="${totalPages > 1}" style="margin-top:16px; display:flex; gap:6px; flex-wrap:wrap;">
        <!-- –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <a class="btn" th:if="${currentPage > 1}"
           th:href="@{/programs(page=${currentPage - 1},sortField=${sortField},sortDir=${sortDir},keyword=${keyword},activeFilter=${activeFilter},regionId=${regionId},coverageId=${coverageId},promo=${promo})}">
            ‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è
        </a>
        <!-- –ù–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü -->
        <span th:each="i : ${#numbers.sequence(1, totalPages)}">
            <a class="btn"
               th:href="@{/programs(page=${i},sortField=${sortField},sortDir=${sortDir},keyword=${keyword},activeFilter=${activeFilter},regionId=${regionId},coverageId=${coverageId},promo=${promo})}"
               th:text="${i}"
               th:classappend="${i == currentPage} ? ' btn-primary'">
            </a>
        </span>
        <!-- –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <a class="btn" th:if="${currentPage < totalPages}"
           th:href="@{/programs(page=${currentPage + 1},sortField=${sortField},sortDir=${sortDir},keyword=${keyword},activeFilter=${activeFilter},regionId=${regionId},coverageId=${coverageId},promo=${promo})}">
            –°–ª–µ–¥—É—é—â–∞—è ‚Ä∫
        </a>
    </div>

</div>
</body>
</html>
